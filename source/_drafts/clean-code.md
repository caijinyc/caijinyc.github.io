---
title: 代码整洁之道
subtitle: "Clean Code: A Handbook of Agile Software Craftsmanship"
date: 2022-08-21
tags:
- 阅读
---

> 工作后就很久没有完整的阅读过技术类型的书，最近抽时间读完了早该阅读的《代码整洁之道》收获良多，本文简单总结。

<!--more-->

## 简评

本书讲解整洁代码的意义，如何辨别整洁的代码，如何写好的代码等，对编码中的命名、函数、注释、类、测试等都做了总结，非常贴合日常编程中的发生的种种问题。是一本适合所有程序员**认真**读一读的好书。

## 笔记

阅读中记录的一些比较重要的点。

### 整洁代码的重要性

作为专业的程序员自然要需要追求好代码，也需要知道糟糕代码带来的灾难，同时知道如何将糟糕代码改成好代码。

#### **糟糕的代码毁了公司**

业务迅速迭代，所有程序员疯狂糊屎。短期看起来可能没什么问题，但是总有一天会发现无法继续维护。

#### **混乱的代价**

随看混乱的增加，团队生产力也持续下降，趋向于零。当生产力下降时，管理层就只有体事可做了：增加更多人手到项目中，期望提升生产力。可是新人并不熟悉系统的设计（不想维护屎山）。

最终导致重构成新的系统，新的系统又需要实现所有老系统的所有功能。而在新系统能够完全和老系统媲美之前，业务老板压根不想让新系统代替老系统（鬼知道会有多少 Bug）。

同时重构之后的新系统一定会更好吗？如果他们还是没有遵守整洁代码的规范，那么将又会是一坐新的屎山，新的轮回。

#### 读与写花费时间的比例超过 10:1

当在写新代码时，我们一直在读旧代码。

读代码是 Coding 时，最常发生的事情，尤其是维护他人的模块，或者自己长期没有维护的模块。

相信你一定有看了 1 个小时代码，最终只改了 1 行的经历（不管你有没有，反正我肯定有，而且不只 1 次，是很多次）。

例如我之前维护的一个比较复杂的的模块，因为初期设计的不合理，导致自己过了一段时间没有维护之后，再上手维护的阅读成本就非常高（也就是常说的自己看不懂自己写的什么东西）。

#### 稍后等于永不

重构应该在日常开发的时候持续的去做，而不是 “等有时间再说”

这句话说的真的很好，且不光是写代码，生活着很多事情都是这样的。例如准备和谁吃个饭，如果不立即开约，那么过一段时间可能就忘了。“下次一定“ 这个梗就是这么来的吧~

#### 必须时时保持代码整洁

<mark>让营地比你来时更干净。</mark>

就像每次都做一点小事，把小事都做好，自然整体就会变好。

如果每次签入时，代码都比签出时干净，那么代码就不会腐坏。清理并不一定要花多少功夫，也许只是改好一个变量名，拆分一个有点过长的函数，消除一点点重复代码，清理一个嵌套 if 语句。

> 随时随地重构垃圾代码是我立即学会的事情并进行实践的事情，推荐大家也立即行动起来。
>
> 稍后等于永不，其实和《**搞定Ⅰ 无压工作的艺术**》中讲的一样，一件小事如果能立即完成，就立刻完成它，而不是稍后在做。喝完牛奶就洗杯子，吃完饭就洗碗，别让这些小事拖垮自己。



## 有意义的命名

在代码中取名真的是一件很困难，但同时又很重要的一件事，书中讲了几点需要重点注意的事。

#### **名副其实**

变量、函数或类的名称应该已经答复了所有的大问题。它该告诉你，它为什么会存在， 它做什么事，应该怎么用。

如果名称需要注释来补充，那就不算是**名副其实**。比如这样：

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/62a51b83-120c-4e9f-9d14-3776ba664385/Untitled.png)

如果团队有 Lint 规则的话，就不要限制命名的长度了。相信我，太短的命名没有办法在很大的作用范围内描述清楚自身的意义。

#### **做有意义的区分**

1. 别用什么 a1, a2 作为变量命名（当心被砍）。
2. 不要用什么 ArrayList 作为命名，既然有 List 了，为什么还要用 Array 呢？

```tsx
// 他们有什么区别吗？
getActiveAccount();
getActiveAccounts();
getActiveAccountInfo();

// 直接用这个就可以
getActiveAccount();
```

#### **使用读得出来的名称**

也就是说别用缩写，或者说别用别人看不懂的缩写，没必要，别坑了以后的自己。况且有 IDE 的补全，所以不要怕名称太长。

#### **方法名用动词**

方法名应当是动词或动词短语，如 postPayment、deletePage 或 save。

#### **添加有意义的语境**

通过添加语境的方式让命名更易读懂。

可以添加前缀 addrFirstName、addrLastName、addrState 等，以此提供语境。至少，读者会明白这些变量是某个更大结构的一部分。当然，更好的方案是创建名为 Address 的类。

#### **不要添加没用的语境**

例如要写一个商品发布（GoodsPublish）的页面，这时候给所有的名称前面都加上 GoodsPublish 就是一件很蠢的事情，例如 GoodsPublishApi, GoodsPublishStore。因为编码时 IDE 提示的备选项会多出一堆。

> 命名是一件很重要的事情，好的命名能让代码可读性提升 100%！
能用命名解决的事情，就不要再加注释了。
>

## 函数

系统由函数组成，我们应该学习如何写好每一个函数。

#### **短小**

短小的函数更利于阅读和理解。

书中指出不成超过 20 行，但我感觉太难了。只能尽量让函数尽可能的短吧。总之编码的时候要牢记函数要短小。

#### **只做一件事**

一个函数做很多事情的时候，可读性就大大降低，测试难度也很高。

只做一件事的函数更便于理解和测试。

#### **单一权责原则**

例如在调用服务端接口的时候，以前可能会说，你给这个接口加个 type 然后根据 type 不同，做不同的事情。其实这个时候应该是让服务端再开一个接口，做单独的事情。

#### **使用描述性的名称**

简单的说就是，函数的名称要能看懂，能讲清楚这个函数是做什么的，同时不要太概括，例如渲染 HTML，renderDOMToPage 就比 render 强。

别害怕长名称。长而具有描述性的名称，要比短而令人费解的名称好。

#### **函数参数**

1. 最理想的参数数量是零：过多的参数测试用例就很难写，因为把所有参数的组合搞出来就是一件痛苦的事情。一般来说参数数量越少的代码越容易理解；
2. 标识参数：标识参数指的就是 Bool 类型的参数，使用 Bool 参数就明显代表了这个 fun 在做两种事情，所以这个时候我们应该把他们拆开！
3. 参数对象：如果函数看来需要两个、三个或三个以上参数，就说明其中一些参数应该封装为类了；
    1. 看起来像作弊，但其实并不是，因为参数对象有着自己的定义，例如我传的是 goods 商品信息，那么它的定义就是商品信息，就是一个整体，我在使用的时候也知道 goods 是个什么东西

#### **无副作用**

也就是我们常说的纯函数，这种函数通常来说更容易理解 & 不容易坑人！

#### **使用异常替代返回错误码**

这个说的就是多用 try catch，而不是抛出看不懂的状态码。

#### **如何写出这样的函数**

先按照感觉写，然后不停的优化你的函数，打磨这些代码，分解函数、修改名称、消除重复。

我（作者）并不从一开始就按照规则写函数。我想没人做得到。**大师级程序员把系统当作故事来讲，而不是当作程序来写。**
