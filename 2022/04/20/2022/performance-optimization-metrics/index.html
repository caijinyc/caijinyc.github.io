<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<title>Web 性能指标定义和获取方法 - 蔡锦的博客 | Jin&#39;s Blog</title>
<!--<title>Web 性能指标定义和获取方法 - Jin&#39;s Blog</title>-->
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-131749872-3"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-131749872-3');
</script>

<link rel="stylesheet" href="/css/osimple.css">


<link rel="stylesheet" href="/css/theme/theme0.css">

<link rel="shortcut icon" href="/favicon.ico"> 
  
<link rel="stylesheet" href="/css/arduino-light.css">

<meta name="generator" content="Hexo 5.4.2"><link rel="alternate" href="/atom.xml" title="Jin's Blog" type="application/atom+xml">
</head>
<body>
  <div class="header-menu post-header-menu">
    <a class="left" href="/">Jin&#39;s Blog</a>
    <div class="right">
      
        <a href="/">HOME</a>
      
        <a href="/weekly/">WEEKLY</a>
      
        <a href="/archives/">ARCHIVE</a>
      
        <a href="/about/">ABOUT</a>
      
        <a href="/atom.xml">RSS</a>
      
    </div>
  </div>
  <main class="page-container">
    <div class="top-inner">
      <h1 class="page-title">
        Web 性能指标定义和获取方法
      </h1>
      
      <h2 class="page-subtitle">
        Web performance optimization metrics and how to get them
      </h2>
      
      
        <time datetime="2022-04-20T00:00:00.000Z">
<!--            Posted by Jin on -->
          April 20th 2022
        </time>
      
      
        <ul class="tag-list">
          
            <li class="tag-list-item">
              <a href="/tags/性能优化/">性能优化</a>
            </li>
          
        </ul>
      
    </div>
    <article class="post">
        <p>如果要做前端页面的性能优化，那么肯定需要一些衡量指标来衡量优化收益。目前业界常用的衡量指标有：FP、FCP、LCP、TTFB 等等，本文简单解释一下这些指标以及如何获取方法。</p>
<span id="more"></span>

<blockquote>
<p>4.21 未完待续…由于本人性能优化实践还在进行中，后续会持续补充内容 &amp; 个人理解。</p>
</blockquote>
<blockquote>
<p> 本文仅仅是我个人的学习和整理，大多数内容来自于 <code>https://web.dev</code>，有部分总结如有错误请大家及时指出；<br> 本文不会提及如何对各指标进行优化，优化实践方案后续会单独更一篇文章；</p>
</blockquote>
<h2 id="First-Paint-FP-首次绘制"><a href="#First-Paint-FP-首次绘制" class="headerlink" title="First Paint (FP) 首次绘制"></a>First Paint (FP) 首次绘制</h2><h3 id="指标定义"><a href="#指标定义" class="headerlink" title="指标定义"></a>指标定义</h3><p>FP 指页面导航与浏览器将该网页的<strong>第一个像素渲染到屏幕上所用的中间时</strong>，渲染是任何与输入网页导航前的屏幕上的内容不同的内容。</p>
<p>在性能统计指标中，从用户开始访问 Web 页面的时间点到 FP 的时间点这段时间可以被视为<strong>白屏时间</strong>，也就是说在用户访问 Web 网页的过程中，FP 时间点之前，用户看到的都是没有任何内容的白色屏幕，用户在这个阶段感知不到任何有效的工作在进行。</p>
<p>如果我们的白屏时间过长，那么用户的流失率就会升高。</p>
<p>我们可以通过 Performance 面板查看到页面的 FP：</p>
<img src="/asset/img/2022/performance-optimizing-metrics/1.png" width="400">

<h3 id="获取方法"><a href="#获取方法" class="headerlink" title="获取方法"></a>获取方法</h3><p>在 MDN 上可以查到 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/API/PerformancePaintTiming">PerformancePaintTiming API</a> 用来获取性能数据，我们可以通过 <code>performance.getEntriesByType(&#39;paint&#39;)</code> 的方法来获取到应用的 FP 值。</p>
<p><img src="/asset/img/2022/performance-optimizing-metrics/2.png"></p>
<blockquote>
<p>注意：这个指标是有兼容性问题的，如果用户的游览器不支持此 API，则在埋点上报处给这部分的用户做好标识即可。</p>
</blockquote>
<h2 id="First-Contentful-Paint-FCP-首次内容绘制"><a href="#First-Contentful-Paint-FCP-首次内容绘制" class="headerlink" title="First Contentful Paint (FCP) 首次内容绘制"></a>First Contentful Paint (FCP) 首次内容绘制</h2><h3 id="指标定义-1"><a href="#指标定义-1" class="headerlink" title="指标定义"></a>指标定义</h3><p>首次内容绘制 (FCP) 指标测量页面从开始加载到页面内容的任何部分在屏幕上完成渲染的时间。对于该指标，<a target="_blank" rel="noopener" href="https://web.dev/lcp/#yuan">“内容” 指的是文本、图像（包括背景图像）、svg 元素或非白色的 canvas 元素</a>。 相比 FP，我认为 FCP 对网站的重要性更为重要，因为 FP 时用户还是无法看到有用的信息，只有完成 FCP 时，用户才能看到网页上的部分信息。</p>
<p><img src="/asset/img/2022/performance-optimizing-metrics/3.png"></p>
<p><a target="_blank" rel="noopener" href="https://web.dev/fcp/#fcp-2">W3C 团队指出</a>：<strong>为了提供良好的用户体验，网站应该努力将首次内容绘制控制在 1.8 秒或以内。</strong>如果网站的 FCP &gt; 3 秒，那么体验就非常糟糕了。</p>
<img src="/asset/img/2022/performance-optimizing-metrics/img.png"  width="500">

<h3 id="获取方法-1"><a href="#获取方法-1" class="headerlink" title="获取方法"></a>获取方法</h3><p>和 FP 相同，直接通过 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/API/PerformancePaintTiming">PerformancePaintTiming API</a> 就能获取到 FCP 的值。</p>
<p><img src="/asset/img/2022/performance-optimizing-metrics/img_1.png"></p>
<h2 id="Largest-Contentful-Paint-LCP-最大内容绘制"><a href="#Largest-Contentful-Paint-LCP-最大内容绘制" class="headerlink" title="Largest Contentful Paint (LCP) 最大内容绘制"></a>Largest Contentful Paint (LCP) 最大内容绘制</h2><h3 id="指标定义-2"><a href="#指标定义-2" class="headerlink" title="指标定义"></a>指标定义</h3><p>LCP 是测量感知加载速度的一个以用户为中心的重要指标，因为该项指标会在页面的主要内容基本加载完成时，在页面加载时间轴中标记出相应的点，迅捷的 LCP 有助于让用户确信页面是有效的。</p>
<p>最大内容绘制 (LCP) 指标会根据页面首次开始加载的时间点来报告可视区域内可见的最大图像或文本块完成渲染的相对时间。</p>
<p><img src="/asset/img/2022/performance-optimizing-metrics/img_2.png"></p>
<p>如果你对细节感兴趣，想知道 W3C 团队是如何定义 LCP 的，可以查看这里：<a target="_blank" rel="noopener" href="https://web.dev/lcp/#yuan-2">何时报告最大内容绘制？</a></p>
<p>W3C 团队同样也给出了推荐的 LCP 时间：</p>
<img src="/asset/img/2022/performance-optimizing-metrics/img_3.png" width="500">

<h3 id="获取方法-2"><a href="#获取方法-2" class="headerlink" title="获取方法"></a>获取方法</h3><p>可以直接参考这个：<a target="_blank" rel="noopener" href="https://github.com/GoogleChrome/web-vitals/blob/main/src/getLCP.ts">getLCP</a>，我这就不贴代码了。</p>
<blockquote>
<p>注意：浏览器需要支持 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/API/Largest_Contentful_Paint_API">Largest Contentful Paint API</a> 和 PerformanceObserver API。</p>
</blockquote>

    </article>
    <div class="pager-post">
    
      <a class="prev-link" href="/2022/05/18/2022/monorepo/">
        <span>PREVIOUS</span>
        <p>实践 Monorepo 模式两年多的一些总结</p>
      </a>
    
    
    
      <a class="next-link" href="/2022/04/11/2022/cache-nodemodules-speed-ci-build/">
        <span>NEXT</span>
        <p>通过依赖缓存的方式实现秒级依赖安装加速 CI 构建</p>
      </a>
    
  </div>
    
  <div class="post-comment-wrapper">
      <div id="disqus_thread"></div>
<!--      <script src="https://utteranc.es/client.js"-->
<!--              repo="caijinyc/caijinyc.github.io"-->
<!--              issue-term="pathname"-->
<!--              theme="github-light"-->
<!--              crossorigin="anonymous"-->
<!--              async>-->
<!--      </script>-->
  </div>

    <div class="post-all-tags">
      <h1 class="title">ALL TAGS</h1>
      <ul class="all-tag-list">
    
      
      <li class="tag-list-item">
        <a href="/tags/%E7%94%9F%E6%B4%BB/">
          生活
          <span class="count">
            5
          </span>
        </a>
      </li>
      
      <li class="tag-list-item">
        <a href="/tags/%E6%80%BB%E7%BB%93/">
          总结
          <span class="count">
            2
          </span>
        </a>
      </li>
      
      <li class="tag-list-item">
        <a href="/tags/CI-CD/">
          CI/CD
          <span class="count">
            1
          </span>
        </a>
      </li>
      
      <li class="tag-list-item">
        <a href="/tags/%E9%98%85%E8%AF%BB/">
          阅读
          <span class="count">
            1
          </span>
        </a>
      </li>
      
      <li class="tag-list-item">
        <a href="/tags/monorepo/">
          monorepo
          <span class="count">
            1
          </span>
        </a>
      </li>
      
      <li class="tag-list-item">
        <a href="/tags/%E8%8B%B1%E8%AF%AD/">
          英语
          <span class="count">
            1
          </span>
        </a>
      </li>
      
      <li class="tag-list-item">
        <a href="/tags/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/">
          性能优化
          <span class="count">
            1
          </span>
        </a>
      </li>
      
      <li class="tag-list-item">
        <a href="/tags/Font/">
          Font
          <span class="count">
            1
          </span>
        </a>
      </li>
      
      <li class="tag-list-item">
        <a href="/tags/%E6%B5%8B%E8%AF%95/">
          测试
          <span class="count">
            1
          </span>
        </a>
      </li>
      
      <li class="tag-list-item">
        <a href="/tags/%E6%80%9D%E8%80%83/">
          思考
          <span class="count">
            1
          </span>
        </a>
      </li>
      
      <li class="tag-list-item">
        <a href="/tags/%E5%B7%A5%E4%BD%9C/">
          工作
          <span class="count">
            1
          </span>
        </a>
      </li>
      
      <li class="tag-list-item">
        <a href="/tags/%E6%B8%B8%E6%88%8F/">
          游戏
          <span class="count">
            1
          </span>
        </a>
      </li>
      
      <li class="tag-list-item">
        <a href="/tags/CSS/">
          CSS
          <span class="count">
            1
          </span>
        </a>
      </li>
      
      <li class="tag-list-item">
        <a href="/tags/JavaScript/">
          JavaScript
          <span class="count">
            8
          </span>
        </a>
      </li>
      
      <li class="tag-list-item">
        <a href="/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/">
          数据结构
          <span class="count">
            1
          </span>
        </a>
      </li>
      
      <li class="tag-list-item">
        <a href="/tags/Git/">
          Git
          <span class="count">
            1
          </span>
        </a>
      </li>
      
      <li class="tag-list-item">
        <a href="/tags/%E5%90%8E%E7%AB%AF/">
          后端
          <span class="count">
            2
          </span>
        </a>
      </li>
      
      <li class="tag-list-item">
        <a href="/tags/Vue/">
          Vue
          <span class="count">
            1
          </span>
        </a>
      </li>
      
      <li class="tag-list-item">
        <a href="/tags/%E7%A7%BB%E5%8A%A8%E7%AB%AF/">
          移动端
          <span class="count">
            1
          </span>
        </a>
      </li>
      
      <li class="tag-list-item">
        <a href="/tags/Form/">
          Form
          <span class="count">
            1
          </span>
        </a>
      </li>
      
    
  </ul>
    </div>
  </main>
  <footer>
  <div class="connect-inner">
      
        <a href="https://github.com/caijinyc" target="_blank" class="github">
          <i class="iconfont icon-github"></i>
        </a>
      
        <a href="https://juejin.im/user/5acc88a8f265da23a2297002" target="_blank" class="juejin">
          <i class="iconfont icon-juejin"></i>
        </a>
      
        <a href="https://www.zhihu.com/people/adherds/activities" target="_blank" class="zhihu">
          <i class="iconfont icon-zhihu"></i>
        </a>
      
  </div>
  <div class="bottom-inner">
    <p class="theme">Theme <a target="_blank" rel="noopener" href="https://github.com/orbem/hexo-theme-osimple">OSimple</a> by Caijinyc</p>
    <p class="copyright">Copyright © 2022 Jin & Powered by <a target="_blank" rel="noopener" href="http://hexo.io">Hexo</a></p>
  </div>
</footer>
  
  <script>
      var disqus_shortname = 'orbem';
      var disqus_config = function () {
          <!--this.page.url = 'https://caijin.tech2022/04/20/2022/performance-optimization-metrics/';-->
          // disqus open comment page url
          this.page.url = 'https://caijin.tech/2022/04/20/2022/performance-optimization-metrics/';
          // disqus use this as comment id
          this.page.identifier = '2022/04/20/2022/performance-optimization-metrics/';
      };

      <!--console.log('11', 'https://caijin.tech2022/04/20/2022/performance-optimization-metrics/', 'title,subtitle,date,_content,source,raw,slug,published,updated,comments,layout,photos,link,_id,content,site,excerpt,more,path,permalink,full_source,asset_dir,tags,categories,prev,next,__post,lang,canonical_path', 'https://caijin.tech/2022/04/20/2022/performance-optimization-metrics/')-->

      (function () {
          var d = document, s = d.createElement('script');
          s.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
          s.setAttribute('data-timestamp', +new Date());
          (d.body || d.head).appendChild(s);
      })();
  </script>

  
<script src="/js/highlight.js"></script>

</body>
</html>


